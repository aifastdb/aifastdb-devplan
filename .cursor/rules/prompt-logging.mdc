---
description: DevPlan Prompt 自动记录规则。当 AI 开始处理用户的开发任务时，自动将用户 Prompt 保存到 DevPlan 的 Prompt 日志中。
globs: []
alwaysApply: false
mcpServers: aifastdb-devplan
---

# DevPlan Prompt 自动记录

## 功能说明

DevPlan 支持将每次用户输入的 Prompt 自动保存到项目的 Prompt 日志中，用于回溯开发过程和分析 AI 交互历史。

## 使用方法

### 手动保存 Prompt

在对话中可随时调用：

```
devplan_save_prompt(
  projectName: "<项目名>",
  content: "<用户原始 Prompt>",
  summary: "<简要摘要>",              // 可选
  relatedTaskId: "phase-X",          // 可选：关联到主任务
  tags: ["feature", "bugfix"]        // 可选：自定义标签
)
```

### 查看 Prompt 日志

```
devplan_list_prompts(projectName: "<项目名>")
devplan_list_prompts(projectName: "<项目名>", date: "2026-02-18")
devplan_list_prompts(projectName: "<项目名>", relatedTaskId: "phase-7")
devplan_list_prompts(projectName: "<项目名>", limit: 10)
```

### 创建主任务时关联 Prompt

```
devplan_create_main_task(
  projectName: "<项目名>",
  taskId: "phase-X",
  title: "...",
  priority: "P0",
  relatedPromptIds: ["<prompt-entity-id>"]  // 来自 devplan_save_prompt 的返回值
)
```

## 自动记录建议

当用户说"记录 prompt"、"保存对话"、"记录到 devplan"时：
1. 提取用户的核心请求内容
2. 生成简要摘要
3. 如果当前有正在进行的阶段（in_progress），自动关联到该主任务
4. 调用 `devplan_save_prompt` 保存

## 注意事项

- Prompt 日志仅支持 `graph` 引擎（SocialGraphV2）
- 每条 Prompt 自动分配当天序号（promptIndex）
- Prompt 与主任务通过 `task_has_prompt` 关系连接
- 可在图谱可视化中看到 Prompt 节点与任务的关联
